import{m as b}from"./index-ARpQKZSe.js";import{S as u}from"./sweetalert2.all-8sO2yy36.js";import{a as _}from"./axios-G2rPRu76.js";import{_ as k,c as n,a as t,d as p,D as l,K as m,G as d,H as c,F as g,I as C,o as a}from"./index-VHrA6eaq.js";const x="https://vue3-course-api.hexschool.io/v2",v="newhandarky";b.locale("zh-tw");b.updateLocale("zh-tw",{meridiem:function(e){return e<12?"上午":"下午"}});const w={data(){return{order:{},user:{},create_at:"",products:{},allProducts:[],productsCount:0,total:0,productFinalTotal:0,productTotal:0}},components:{},methods:{openOffCanvasNav(){this.$refs.backendNav.openNav()},getOrder(){const e=this.$route.params.id;e&&_.get(`${x}/api/${v}/order/${e}`).then(o=>{this.order=o.data.order,this.user=o.data.order.user,this.products=o.data.order.products,this.total=o.data.order.total,this.productsCount=Object.keys(this.products).length,this.create_at=b.unix(this.order.create_at).format("YYYY年 MM月 DD日 A h時 : mm分 : ss秒")}).catch(()=>{u.fire("取得訂單資料失敗")})},backToList(){this.$router.push("/admin/orders")},orderIsPaid(){u.fire({icon:"warning",title:"此訂單確定結帳嗎?",showCancelButton:!0,confirmButtonText:"確定",confirmButtonColor:"#1B8754"}).then(e=>{e.isConfirmed&&(u.fire("訂單已結帳","","success"),this.order.is_paid=!0,this.updateOrderApi())})},updateOrder(){u.fire({icon:"warning",title:"確定要修改訂單資料嗎?",showCancelButton:!0,confirmButtonText:"確定",confirmButtonColor:"#1B8754"}).then(e=>{e.isConfirmed&&(this.updateOrderApi(),u.fire("訂單已修改, 將返回列表","","success"))})},updateOrderApi(){this.order.total=this.total;const e={data:this.order};_.put(`${x}/api/${v}/admin/order/${this.$route.params.id}`,e).then(o=>{this.$router.push("/admin/orders")}).catch(()=>{u.fire("更新訂單資料失敗")})},removeProduct(e){delete this.products[e],this.productsCount=Object.keys(this.products).length},showCoupon(e){return e==="specialPrice60"?"六折優惠":e==="specialPrice80"?"八折優惠":"無使用優惠"},getTotal(e){return e.total=Math.round(e.product.price*e.qty),e.total},getFinalTotal(e){var h;let o=1;return(h=e==null?void 0:e.coupon)!=null&&h.percent&&(o=e.coupon.percent/100),e.final_total=Math.round(e.product.price*e.qty*o),e.final_total},getOrderTotal(){this.total=0,Object.values(this.order.products).forEach(e=>{this.total+=e.final_total})}},watch:{"order.products":{deep:!0,handler(){this.getOrderTotal()}}},mounted(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexschoolToken\s*=\s*([^;]*).*$)|^.*$/,"$1");_.defaults.headers.common.Authorization=e,this.getOrder()}},O={class:"container"},T=t("h2",{class:"text-primary mb-0 py-3"},"編輯訂單",-1),B={class:"row border rounded p-3"},V={class:"text-primary mb-3"},P={class:"fs-5 ms-3 text-dark"},U={class:"mb-0 d-flex justify-content-between"},j={class:"text-primary mb-0"},q={class:"fs-5 ms-3 text-dark"},A={class:"d-flex"},D={class:"col-6 p-3"},F={class:"row"},L={class:"mb-2 col-6"},M=t("h5",{class:"text-primary"},"姓名",-1),N={class:"mb-2 col-6"},z=t("h5",{class:"text-primary"},"連絡電話",-1),I={class:"mb-2 col-6"},Y=t("h5",{class:"text-primary"},"Email",-1),E={class:"mb-2 col-6"},S=t("h5",{class:"text-primary"},"收件地址",-1),G={class:"col-6 p-3"},H={class:"mb-2"},K=t("h5",{class:"text-primary"},"備註",-1),J={class:"row"},Q={class:"mb-2 col-3"},R=t("h5",{class:"text-primary"},"訂單品項",-1),W={class:"mb-2 col-3"},X=t("h5",{class:"text-primary"},"訂單金額",-1),Z={class:"mb-2 col-3"},$=t("h5",{class:"text-primary"},"訂單狀態",-1),tt={key:0,type:"text",class:"form-control",disabled:"",value:"已付款"},st={key:1,type:"text",class:"form-control text-danger",disabled:"",value:"未付款"},et={class:"mb-2 col-3"},ot=t("h5",{class:"text-primary"},"訂單結帳",-1),rt={key:0,type:"button",class:"btn btn-outline-secondary w-100",disabled:""},it=t("hr",{class:"mb-0"},null,-1),nt={class:"p-3"},lt={class:"d-flex mb-3 d-flex align-items-center justify-content-between"},at={class:"text-primary mb-0"},dt=["onClick"],ct={class:"col-3 d-flex align-items-center"},ut={class:"mb-0"},mt={class:"col-3 d-flex align-items-center"},ht=["onClick"],_t={class:"mb-0"},pt=["onClick"],bt={class:"col-3"},ft={class:"mb-0"},yt={class:"col-3 d-flex align-items-center justify-content-end"},xt={key:0,class:"mb-0"},vt={key:1,class:"mb-0"},kt={class:"ms-3 fs-5 text-secondary text-decoration-line-through"},gt={class:"ms-3 text-danger"};function Ct(e,o,h,wt,r,i){return a(),n("div",O,[T,t("div",B,[t("h4",V,[p("訂單編號 "),t("span",P,l(r.order.create_at),1)]),t("div",U,[t("h4",j,[p("訂單成立時間 "),t("span",q,l(r.create_at),1)]),t("div",A,[t("button",{type:"button",class:"btn btn-outline-primary me-3",onClick:o[0]||(o[0]=(...s)=>i.backToList&&i.backToList(...s))},"返回列表"),t("button",{type:"button",class:m(["btn btn-outline-primary me-3",{disabled:r.order.is_paid}]),onClick:o[1]||(o[1]=(...s)=>i.getOrder&&i.getOrder(...s))},"回復初始值",2),t("button",{type:"button",class:m(["btn btn-outline-success me-1",{disabled:r.order.is_paid}]),onClick:o[2]||(o[2]=(...s)=>i.updateOrder&&i.updateOrder(...s))},"確認修改",2)])]),t("div",D,[t("div",F,[t("div",L,[M,d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>r.user.name=s)},null,512),[[c,r.user.name]])]),t("div",N,[z,d(t("input",{type:"tel",class:"form-control","onUpdate:modelValue":o[4]||(o[4]=s=>r.user.tel=s)},null,512),[[c,r.user.tel]])]),t("div",I,[Y,d(t("input",{type:"email",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=s=>r.user.email=s)},null,512),[[c,r.user.email]])]),t("div",E,[S,d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[6]||(o[6]=s=>r.user.address=s)},null,512),[[c,r.user.address]])])])]),t("div",G,[t("div",H,[K,d(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[7]||(o[7]=s=>r.order.message=s)},null,512),[[c,r.order.message]])]),t("div",J,[t("div",Q,[R,d(t("input",{type:"number",class:"form-control",disabled:"","onUpdate:modelValue":o[8]||(o[8]=s=>r.productsCount=s)},null,512),[[c,r.productsCount]])]),t("div",W,[X,d(t("input",{type:"number",class:"form-control",disabled:"","onUpdate:modelValue":o[9]||(o[9]=s=>r.total=s)},null,512),[[c,r.total]])]),t("div",Z,[$,r.order.is_paid?(a(),n("input",tt)):(a(),n("input",st))]),t("div",et,[ot,r.order.is_paid?(a(),n("button",rt,"訂單已付款")):(a(),n("button",{key:1,type:"button",class:"btn btn-outline-success w-100",onClick:o[10]||(o[10]=(...s)=>i.orderIsPaid&&i.orderIsPaid(...s))},"確認付款"))])])]),it,t("div",nt,[(a(!0),n(g,null,C(r.order.products,s=>{var f;return a(),n("div",{key:s.id,class:"border p-3 rounded mt-3 row"},[t("div",lt,[t("h4",at,l(s.product.title),1),t("button",{class:m(["btn btn-outline-danger",{disabled:r.productsCount===1||r.order.is_paid}]),type:"button",onClick:y=>i.removeProduct(s.id)},"移除商品",10,dt)]),t("div",ct,[t("h5",ut,"單價 : "+l(s.product.price),1)]),t("div",mt,[t("button",{type:"button",class:m(["btn btn-outline-primary me-3",{disabled:s.qty===1||r.order.is_paid}]),onClick:y=>s.qty--},"-",10,ht),t("h5",_t,"數量 : "+l(s.qty),1),t("button",{type:"button",class:m(["btn btn-outline-primary ms-3",{disabled:r.order.is_paid}]),onClick:y=>s.qty++},"+",10,pt)]),t("div",bt,[t("h5",ft,"折價券 : "+l(i.showCoupon((f=s==null?void 0:s.coupon)==null?void 0:f.code)),1)]),t("div",yt,[s.final_total===s.total?(a(),n("h5",xt,"小計 : "+l(i.getFinalTotal(s)),1)):(a(),n("h5",vt,[p("小計 : "),t("span",kt,l(i.getTotal(s)),1),t("span",gt,l(i.getFinalTotal(s))+" 元",1)]))])])}),128))])])])}const Pt=k(w,[["render",Ct]]);export{Pt as default};
