import{b as I}from"./bootstrap.min-tYduo9KN.js";import{_ as b,o as r,c as l,a as t,N as B,L as a,d as C,G as c,H as u,F as M,I as V,E as S,b as U,w as N,r as v,p as T,e as D}from"./index-VHrA6eaq.js";import{a as f}from"./axios-G2rPRu76.js";import{S as p}from"./sweetalert2.all-8sO2yy36.js";const E={data(){return{productModal:null,product:{}}},methods:{modalShow(e){this.product=e,this.productModal.show()},modalHide(){this.productModal.hide()},onlyShow(){this.productModal.show()}},mounted(){this.productModal=new I.Modal(this.$refs.productModal,{keyboard:!0})}},F={class:"modal fade",ref:"productModal",tabindex:"-1","aria-hidden":"true"},L={class:"modal-dialog modal-dialog-centered"},R={class:"modal-content"},W={class:"modal-body text-center"};function z(e,o,h,w,n,d){return r(),l("div",F,[t("div",L,[t("div",R,[t("div",W,[B(e.$slots,"modal-body")])])])],512)}const H=b(E,[["render",z]]),O="https://vue3-course-api.hexschool.io/v2",j="newhandarky",A={data(){return{inputModal:null,imageUrl:"",apiUploadImage:`${O}/api/${j}/admin/upload`,index:0}},methods:{modalShow(e){this.index=e,this.inputModal.show()},modalHide(){this.inputModal.hide()},submitForm(){const e=new FormData;e.append("file",this.$refs.fileInput.files[0]),f.post(this.apiUploadImage,e).then(o=>{this.imageUrl=o.data.imageUrl,this.$emit("upload-success",this.imageUrl,this.index),this.inputModal.hide()}).catch(o=>{console.log(o),this.$emit("upload-error",o),this.inputModal.hide()})}},mounted(){this.inputModal=new I.Modal(this.$refs.inputModal,{keyboard:!0});const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexschoolToken\s*=\s*([^;]*).*$)|^.*$/,"$1");f.defaults.headers.common.Authorization=e}},G={class:"modal fade",ref:"inputModal",tabindex:"-1","aria-hidden":"true"},q={class:"modal-dialog modal-dialog-centered"},J={class:"modal-content"},K={class:"modal-body text-center"},Q=t("h3",{class:"text-primary"},"請選擇要上傳的圖片檔案",-1),X=t("p",{class:"text-danger"},[C("請注意，僅限使用 jpg、jpeg 與 png 格式， "),t("br"),C(" 檔案大小限制為 3MB 以下。")],-1),Y=["action"],Z={type:"file",name:"file-to-upload",ref:"fileInput",class:"form-control rounded rounded-bottom-0 border-primary border-bottom-0"},tt=t("input",{type:"submit",value:"上傳檔案",class:"form-control btn btn-outline-primary rounded rounded-top-0"},null,-1);function ot(e,o,h,w,n,d){return r(),l("div",G,[t("div",q,[t("div",J,[t("div",K,[Q,X,t("form",{action:n.apiUploadImage,enctype:"multipart/form-data",method:"post",onSubmit:o[0]||(o[0]=a((...m)=>d.submitForm&&d.submitForm(...m),["prevent"]))},[t("input",Z,null,512),tt],40,Y)])])])],512)}const et=b(A,[["render",ot]]),st={data(){return{changeUrlModal:null,imageUrl:"",index:0}},methods:{modalShow(e){this.index=e,this.changeUrlModal.show()},modalHide(){this.changeUrlModal.hide()},changeUrl(){this.$emit("change-url",this.imageUrl,this.index),this.changeUrlModal.hide()}},mounted(){this.changeUrlModal=new I.Modal(this.$refs.changeUrlModal,{keyboard:!0})}},nt={class:"modal fade",ref:"changeUrlModal",tabindex:"-1","aria-hidden":"true"},dt={class:"modal-dialog modal-dialog-centered"},rt={class:"modal-content"},lt={class:"modal-body text-center"},it=t("h3",{class:"text-primary"},"請輸入要更換的圖片路徑",-1);function at(e,o,h,w,n,d){return r(),l("div",nt,[t("div",dt,[t("div",rt,[t("div",lt,[it,c(t("input",{type:"url",class:"form-control rounded-bottom-0","onUpdate:modelValue":o[0]||(o[0]=m=>n.imageUrl=m)},null,512),[[u,n.imageUrl]]),t("button",{type:"bottom",class:"form-control btn btn-outline-primary rounded-top-0",onClick:o[1]||(o[1]=(...m)=>d.changeUrl&&d.changeUrl(...m))},"送出修改")])])])],512)}const ct=b(st,[["render",at]]),y="https://vue3-course-api.hexschool.io/v2",x="newhandarky",k=p.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=p.stopTimer,e.onmouseleave=p.resumeTimer}}),ut={data(){return{product:{},defaultImageUrl:"https://www.ils.com.tw/zh/Up_files/webskin/RWD/include/images/type3album_blank.png",newImageUrl:"",showImageUrl:"",newImagesUrl:[],defaultProduct:{category:"",content:"",description:"",imageUrl:"https://www.ils.com.tw/zh/Up_files/webskin/RWD/include/images/type3album_blank.png",imagesUrl:["https://www.ils.com.tw/zh/Up_files/webskin/RWD/include/images/type3album_blank.png"],is_enabled:0,origin_price:0,price:0,title:"",unit:""},showUrl:!1}},components:{modal:H,uploadImageModal:et,changeUrlModal:ct},methods:{openOffCanvasNav(){this.$refs.backendNav.openNav()},modalShow(e){e!==this.defaultImageUrl&&this.$refs.modal.modalShow(e)},uploadModalShow(e){this.$refs.inputModal.modalShow(e)},changeUrlModalShow(e){this.$refs.changeUrlModal.modalShow(e)},addNewImage(){this.showImageUrl=this.newImageUrl,this.newImagesUrl.push(this.showImageUrl),this.showImageUrl=this.defaultImageUrl,this.newImageUrl=""},getProduct(){const e=this.$route.params.id;e?f.get(`${y}/api/${x}/product/${e}`).then(o=>{this.product=o.data.product,this.product.imagesUrl&&(this.newImagesUrl=this.product.imagesUrl.filter(h=>h!==""))}).catch(o=>{console.log(o)}):this.product=this.defaultProduct},addProduct(){this.product.imagesUrl=this.newImagesUrl;const e=this.product;f.post(`${y}/api/${x}/admin/product`,{data:e}).then(()=>{p.fire({title:"產品新增成功",confirmButtonText:"返回產品列表"}).then(o=>{o.isConfirmed&&this.$router.push("/admin/products")})}).catch(()=>{p.fire("產品新增失敗")})},enabledProduct(){this.product.is_enabled===0?this.product.is_enabled=1:this.product.is_enabled===1&&(this.product.is_enabled=0)},enabledRecommend(){this.product.is_recommend===0||this.product.is_recommend===void 0?this.product.is_recommend=1:this.product.is_recommend===1&&(this.product.is_recommend=0)},backToList(){this.$router.push("/admin/products")},updateProduct(){const e=this.$route.params.id;this.product.imagesUrl=this.newImagesUrl;const o=this.product;f.put(`${y}/api/${x}/admin/product/${e}`,{data:o}).then(()=>{p.fire({title:"系統訊息",text:"產品內容已更新, 將返回產品列表",icon:"success"}),this.$router.push("/admin/products")}).catch(()=>{p.fire("系統更新失敗")})},deleteImage(e){this.newImagesUrl.splice(e,1),k.fire({icon:"success",title:"系統訊息 - 圖片已刪除"})},changeMainImg(e){const o=this.product.imageUrl;this.product.imageUrl=this.newImagesUrl[e],this.newImagesUrl[e]=o,k.fire({icon:"success",title:"系統訊息 - 產品首圖設定成功"})},confirmUpdate(){p.mixin({customClass:{confirmButton:"btn btn-success",cancelButton:"btn btn-danger"},buttonsStyling:!0}).fire({title:"系統訊息",text:"確定要更新產品資訊嗎?",icon:"info",showCancelButton:!0,confirmButtonText:"確定更新",cancelButtonText:"取消更新",reverseButtons:!0}).then(o=>{o.isConfirmed?this.updateProduct():o.dismiss===p.DismissReason.cancel&&k.fire({icon:"warning",title:"取消更新 - 系統將不會儲存您的變更"})})},uploadSuccess(e,o){o===-1?this.product.imageUrl=e:o===void 0?this.newImagesUrl.push(e):this.newImagesUrl[o]=e},uploadError(){p.fire("圖片上傳失敗")}},mounted(){this.getProduct(),this.showImageUrl=this.defaultImageUrl}},i=e=>(T("data-v-21f31af9"),e=e(),D(),e),pt={class:"container main"},mt={class:"row border rounded p-3"},ht={class:"col-4 overflow-scroll p-3"},_t=i(()=>t("h4",{class:"text-primary"},"商品主圖",-1)),gt={class:"text-center mb-2"},ft=["src"],bt=i(()=>t("button",{class:"btn btn-outline-primary form-control rounded-top-0 dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},"編輯產品主圖",-1)),wt={class:"dropdown-menu"},Ut={class:"row main__sub__pics__block"},vt=i(()=>t("h4",{class:"text-primary align-self-start"},"產品副圖片",-1)),yt={key:0,class:"mb-3 position-relative"},xt=["onClick"],kt=["src"],Mt={key:0},It=["onUpdate:modelValue"],Ct={key:1},St=i(()=>t("button",{class:"btn btn-outline-primary form-control rounded-top-0 dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},"編輯圖片",-1)),$t={class:"dropdown-menu"},Pt=["onClick"],Bt=["onClick"],Vt=["onClick"],Nt=["onClick"],Tt={class:"col-6"},Dt=["src"],Et=i(()=>t("button",{class:"btn btn-outline-primary form-control rounded-top-0 dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},"新增圖片",-1)),Ft={class:"dropdown-menu"},Lt={class:"col-8 p-3 position-relative"},Rt={class:"mb-2"},Wt=i(()=>t("h4",{class:"text-primary"},"產品編號",-1)),zt={class:"mb-2"},Ht=i(()=>t("h4",{class:"text-primary"},"產品名稱",-1)),Ot={class:"mb-2 row"},jt={class:"col-6 mb-2"},At=i(()=>t("h4",{class:"text-primary"},"產品分類",-1)),Gt={class:"col-6"},qt=i(()=>t("h4",{class:"text-primary"},"單位",-1)),Jt={class:"col-6"},Kt=i(()=>t("h4",{class:"text-primary"},"原價",-1)),Qt={class:"col-6"},Xt=i(()=>t("h4",{class:"text-primary"},"售價",-1)),Yt={class:"mb-2"},Zt=i(()=>t("h4",{class:"text-primary"},"產品描述",-1)),to=i(()=>t("h4",{class:"text-primary"},"說明內容",-1)),oo={class:"position-absolute bottom-0 start-0 d-flex p-3"},eo={class:"d-flex"},so=i(()=>t("h4",{class:"mb-0 text-primary"},"商品狀態",-1)),no={class:"position-absolute bottom-0 end-0 p-3"},ro=["src"];function lo(e,o,h,w,n,d){const m=v("modal"),$=v("uploadImageModal"),P=v("changeUrlModal");return r(),l(M,null,[t("div",pt,[t("div",mt,[t("div",ht,[_t,t("div",gt,[t("a",{href:"#",onClick:o[0]||(o[0]=a(s=>d.modalShow(n.product.imageUrl),["prevent"]))},[t("img",{class:"main__pic rounded-top",src:n.product.imageUrl,alt:"商品主圖"},null,8,ft)]),bt,t("ul",wt,[t("li",null,[t("a",{class:"dropdown-item",onClick:o[1]||(o[1]=a(s=>d.uploadModalShow(-1),["prevent"])),href:"#"},"上傳檔案")]),t("li",null,[t("a",{class:"dropdown-item",onClick:o[2]||(o[2]=a(s=>d.changeUrlModalShow(-1),["prevent"])),href:"#"},"設定圖片路徑")])])]),t("div",Ut,[vt,(r(!0),l(M,null,V(n.newImagesUrl,(s,_)=>(r(),l("div",{key:s,class:"col-6 text-center"},[s?(r(),l("div",yt,[t("a",{href:"#",onClick:a(g=>d.modalShow(s),["prevent"])},[t("img",{src:s,alt:"商品副圖片",class:"main__sub__pics rounded-top"},null,8,kt)],8,xt),n.showUrl?(r(),l("div",Mt,[c(t("input",{type:"text",class:"form-control rounded-0 rounded-bottom","onUpdate:modelValue":g=>n.newImagesUrl[_]=g},null,8,It),[[u,n.newImagesUrl[_]]])])):(r(),l("div",Ct,[St,t("ul",$t,[t("li",null,[t("a",{class:"dropdown-item",onClick:a(g=>d.changeMainImg(_),["prevent"]),href:"#"},"設為主圖",8,Pt)]),t("li",null,[t("a",{class:"dropdown-item",onClick:a(g=>d.uploadModalShow(_),["prevent"]),href:"#"},"上傳檔案",8,Bt)]),t("li",null,[t("a",{class:"dropdown-item",onClick:a(g=>d.changeUrlModalShow(_),["prevent"]),href:"#"},"設定圖片路徑",8,Vt)]),t("li",null,[t("a",{class:"dropdown-item text-danger",onClick:a(g=>d.deleteImage(_),["prevent"]),href:"#"},"刪除此圖片",8,Nt)])])]))])):S("",!0)]))),128)),t("div",Tt,[t("div",null,[t("img",{class:"main__sub__pics rounded-top border border-primary border-bottom-0",src:n.showImageUrl},null,8,Dt),Et,t("ul",Ft,[t("li",null,[t("a",{class:"dropdown-item",onClick:o[3]||(o[3]=a(s=>d.uploadModalShow(),["prevent"])),href:"#"},"上傳檔案")]),t("li",null,[t("a",{class:"dropdown-item",onClick:o[4]||(o[4]=a(s=>d.changeUrlModalShow(),["prevent"])),href:"#"},"設定圖片路徑")])])])])])]),t("div",Lt,[t("div",Rt,[Wt,c(t("input",{type:"text",class:"form-control rounded-top",disabled:"","onUpdate:modelValue":o[5]||(o[5]=s=>n.product.id=s)},null,512),[[u,n.product.id]])]),t("div",zt,[Ht,c(t("input",{type:"text",class:"form-control rounded-top","onUpdate:modelValue":o[6]||(o[6]=s=>n.product.title=s)},null,512),[[u,n.product.title]])]),t("div",Ot,[t("div",jt,[At,c(t("input",{type:"text",class:"form-control rounded-top","onUpdate:modelValue":o[7]||(o[7]=s=>n.product.category=s)},null,512),[[u,n.product.category]])]),t("div",Gt,[qt,c(t("input",{type:"text",class:"form-control rounded-top","onUpdate:modelValue":o[8]||(o[8]=s=>n.product.unit=s)},null,512),[[u,n.product.unit]])]),t("div",Jt,[Kt,c(t("input",{type:"number",class:"form-control rounded-top","onUpdate:modelValue":o[9]||(o[9]=s=>n.product.origin_price=s)},null,512),[[u,n.product.origin_price]])]),t("div",Qt,[Xt,c(t("input",{type:"number",class:"form-control rounded-top","onUpdate:modelValue":o[10]||(o[10]=s=>n.product.price=s)},null,512),[[u,n.product.price]])])]),t("div",Yt,[Zt,c(t("textarea",{"onUpdate:modelValue":o[11]||(o[11]=s=>n.product.content=s),class:"w-100",rows:"3"},null,512),[[u,n.product.content]]),to,c(t("textarea",{"onUpdate:modelValue":o[12]||(o[12]=s=>n.product.description=s),class:"w-100",rows:"3"},null,512),[[u,n.product.description]])]),t("div",oo,[t("div",eo,[so,n.product.is_enabled?(r(),l("button",{key:0,type:"button",class:"btn btn-outline-primary bottom-0 start-0 ms-3",onClick:o[13]||(o[13]=(...s)=>d.enabledProduct&&d.enabledProduct(...s))},"已啟用")):(r(),l("button",{key:1,type:"button",class:"btn btn-outline-secondary bottom-0 start-0 ms-3",onClick:o[14]||(o[14]=(...s)=>d.enabledProduct&&d.enabledProduct(...s))},"未啟用"))])]),t("div",no,[t("button",{type:"button",class:"btn btn-outline-primary ms-3",onClick:o[15]||(o[15]=(...s)=>d.backToList&&d.backToList(...s))},"返回產品列表"),n.product.id?(r(),l("button",{key:0,type:"button",class:"btn btn-outline-primary ms-3",onClick:o[16]||(o[16]=(...s)=>d.getProduct&&d.getProduct(...s))},"回復初始值")):S("",!0),n.product.id?(r(),l("button",{key:1,type:"button",class:"btn btn-outline-success ms-3",onClick:o[17]||(o[17]=(...s)=>d.confirmUpdate&&d.confirmUpdate(...s))},"確定修改")):(r(),l("button",{key:2,type:"button",class:"btn btn-outline-primary ms-3",onClick:o[18]||(o[18]=(...s)=>d.addProduct&&d.addProduct(...s))},"新增商品"))])])])]),U(m,{ref:"modal"},{"modal-body":N(()=>[t("img",{src:n.product.imageUrl,alt:"#",class:"modal__img"},null,8,ro)]),_:1},512),U($,{ref:"inputModal",onUploadSuccess:d.uploadSuccess,onUploadError:d.uploadError},null,8,["onUploadSuccess","onUploadError"]),U(P,{ref:"changeUrlModal",onChangeUrl:d.uploadSuccess},null,8,["onChangeUrl"])],64)}const io=b(ut,[["render",lo],["__scopeId","data-v-21f31af9"]]),ao={data(){return{}},components:{updateProduct:io},methods:{openOffCanvasNav(){this.$refs.backendNav.openNav()},modalShow(e){this.$refs.modal.modalShow(e)}}},co=t("div",{class:"container"},[t("h2",{class:"text-primary mb-0 py-3"},"產品編輯")],-1);function uo(e,o,h,w,n,d){const m=v("updateProduct");return r(),l(M,null,[co,U(m)],64)}const go=b(ao,[["render",uo]]);export{go as default};
